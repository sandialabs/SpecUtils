/* SpecUtils: a library to parse, save, and manipulate gamma spectrum data files.
 
 Copyright 2018 National Technology & Engineering Solutions of Sandia, LLC
 (NTESS). Under the terms of Contract DE-NA0003525 with NTESS, the U.S.
 Government retains certain rights in this software.
 For questions contact William Johnson via email at wcjohns@sandia.gov, or
 alternative emails of interspec@sandia.gov.
 
 This library is free software; you can redistribute it and/or
 modify it under the terms of the GNU Lesser General Public
 License as published by the Free Software Foundation; either
 version 2.1 of the License, or (at your option) any later version.
 
 This library is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 Lesser General Public License for more details.
 
 You should have received a copy of the GNU Lesser General Public
 License along with this library; if not, write to the Free Software
 Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
 */

#include <vector>
#include <iostream>

#define DOCTEST_CONFIG_IMPLEMENT_WITH_MAIN
#include "doctest.h"

#include "SpecUtils/SpecFile.h"
#include "SpecUtils/EnergyCalibration.h"


void test_rebin_case( const std::vector<float> &original_energies,
                     const std::vector<float> &original_counts,
                     const std::vector<float> &new_energies )
{
  std::vector<float> resulting_counts;
  SpecUtils::rebin_by_lower_edge( original_energies, original_counts, new_energies, resulting_counts );
  
  double origsum = 0.0, newsum = 0.0;
  for( size_t i = 0; i < original_counts.size(); ++i )
    origsum += original_counts[i];
  for( size_t i = 0; i < resulting_counts.size(); ++i )
    newsum += resulting_counts[i];
  
  //if( (fabs(newsum-origsum) > 0.01*original_energies.size()/16384.0)
  //   || (fabs(newsum-origsum) > 1.0E-6*origsum) )
  //  printf( "Failed with difference %f\n", (newsum-origsum) );
  //printf( "Original %9f vs new %9f\n\n\n", origsum, newsum );
  
  CHECK_MESSAGE( ( (fabs(newsum-origsum) < 0.01*original_energies.size()/16384.0)
                  && (fabs(newsum-origsum) < 1.0E-5*origsum) ), "Failed with difference " << (newsum-origsum) << " and origsum=" << origsum );
}//test_rebin_case

TEST_CASE( "Test Rebin" )
{
  {
    printf( "Trying case with coutns at very begging\n" );
    std::vector<float> original_energies{0.233857304f, 0.421279311f, 0.608701348f, 0.796123266f, 0.983545244f, 1.17096734f, 1.35838914f, 1.54581118f, 1.73323321f, 1.92065525f, 2.10807729f, 2.29549932f, 2.48292112f, 2.67034316f, 2.85776496f, 3.045187f, 3.23260903f, 3.42003083f, 3.60745287f, 3.79487491f, 3.98229694f, 4.16971827f, 4.35714054f, 4.54456234f, 4.73198366f, 4.91940594f, 5.10682774f, 5.29425001f, 5.48167181f, 5.66909361f, 5.85651541f, 6.04393768f, 6.23135948f, 6.4187808f, 6.60620308f, 6.79362488f, 6.98104668f, 7.16846848f, 7.35589075f, 7.54331207f, 7.73073435f, 7.91815615f, 8.10557747f, 8.29299927f, 8.48042202f, 8.66784382f, 8.85526466f, 9.04268646f, 9.23010826f, 9.41753101f, 9.60495281f, 9.79237366f, 9.97979546f, 10.1672182f, 10.35464f, 10.5420609f, 10.7294827f, 10.9169044f, 11.1043272f, 11.291748f, 11.4791698f, 11.6665916f, 11.8540144f, 12.0414352f, 12.228857f, 12.4162788f, 12.6037006f, 12.7911224f, 12.9785442f, 13.165966f, 13.3533869f, 13.5408096f, 13.7282314f, 13.9156523f, 14.1030741f, 14.2904959f, 14.4779177f, 14.6653395f, 14.8527613f, 15.0401821f, 15.2276049f, 15.4150267f, 15.6024475f, 15.7898693f, 15.9772911f, 16.1647129f, 16.3521347f, 16.5395584f, 16.7269802f, 16.9144001f, 17.1018219f, 17.2892437f, 17.4766655f, 17.6640873f, 17.8515072f, 18.038929f, 18.2263508f, 18.4137745f, 18.6011963f, 18.7886162f, 3051.85034f, 3052.0376f, 3052.2251f, 3052.4126f, 3052.59961f, 3052.78711f, 3052.97461f, 3053.16187f, 3053.34912f, 3053.53662f, 3053.72388f, 3053.91113f, 3054.09863f, 3054.28589f, 3054.47339f, 3054.66064f, 3054.84814f, 3055.0354f, 3055.22266f, 3055.41016f, 3055.59741f, 3055.78491f, 3055.97217f, 3056.15942f, 3056.34692f, 3056.53442f, 3056.72144f, 3056.90894f, 3057.09644f, 3057.28345f, 3057.47095f, 3057.65845f, 3057.8457f, 3058.03296f, 3058.22046f, 3058.40771f, 3058.59497f, 3058.78247f, 3058.96973f, 3059.15723f, 3059.34448f, 3059.53198f, 3059.71924f, 3059.90674f, 3060.09399f, 3060.28125f, 3060.46875f, 3060.65601f, 3060.84326f, 3061.03076f, 3061.21826f, 3061.40527f, 3061.59277f, 3061.78027f, 3061.96729f, 3062.15479f, 3062.34229f, 3062.52954f, 3062.7168f, 3062.9043f, 3063.09155f, 3063.27905f, 3063.46631f, 3063.65381f, 3063.84106f, 3064.02832f, 3064.21582f, 3064.40308f, 3064.59058f, 3064.77783f, 3064.96509f, 3065.15259f, 3065.33984f, 3065.5271f, 3065.7146f, 3065.9021f, 3066.08911f, 3066.27661f, 3066.46411f, 3066.65137f, 3066.83862f, 3067.02612f, 3067.21338f, 3067.40063f, 3067.58813f, 3067.77539f, 3067.96289f, 3068.15015f, 3068.33765f, 3068.5249f, 3068.71216f, 3068.89966f, 3069.08691f, 3069.27441f, 3069.46167f, 3069.64893f, 3069.83643f, 3070.02393f, 3070.21094f};
    std::vector<float> original_counts{10, 9, 0, 8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 2, 8, 36, 117, 216, 283, 318, 272, 305, 332, 295, 289, 295, 326, 294, 323, 315, 305, 278, 295, 271, 261, 283, 277, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 2, 0};
    std::vector<float> new_energies{-0.0297551602f, 0.15851362f, 0.346782386f, 0.535051167f, 0.723319948f, 0.911588728f, 1.09985757f, 1.28812635f, 1.47639513f, 1.66466391f, 1.85293269f, 2.04120159f, 2.22947025f, 2.41773891f, 2.60600781f, 2.79427671f, 2.98254538f, 3.17081404f, 3.35908294f, 3.54735184f, 3.7356205f, 3.92388916f, 4.1121583f, 4.30042696f, 4.48869562f, 4.67696428f, 4.86523294f, 5.05350208f, 5.24177074f, 5.43003941f, 5.61830854f, 5.80657721f, 5.99484587f, 6.18311453f, 6.37138319f, 6.55965233f, 6.74792099f, 6.93618965f, 7.12445879f, 7.31272745f, 7.50099611f, 7.68926477f, 7.87753344f, 8.06580162f, 8.25407124f, 8.4423399f, 8.63060856f, 8.81887722f, 9.00714588f, 9.19541454f, 9.3836832f, 9.57195187f, 9.76022053f, 9.94849014f, 10.1367588f, 10.3250275f, 10.5132961f, 10.7015648f, 10.8898335f, 11.0781021f, 11.2663717f, 11.4546404f, 11.642909f, 11.8311777f, 12.0194464f, 12.207715f, 12.3959837f, 12.5842524f, 12.772521f, 12.9607906f, 13.1490593f, 13.337328f, 13.5255966f, 13.7138653f, 13.9021339f, 14.0904026f, 14.2786722f, 14.4669409f, 14.6552095f, 14.8434782f, 15.0317469f, 15.2200155f, 15.4082842f, 15.5965528f, 15.7848215f, 15.9730902f, 16.1613598f, 16.3496284f, 16.537899f, 16.7261677f, 16.9144363f, 17.102705f, 17.2909737f, 17.4792423f, 17.667511f, 17.8557796f, 18.0440483f, 18.232317f, 18.4205856f, 18.6088543f, 3065.92725f, 3066.11548f, 3066.30396f, 3066.49219f, 3066.68042f, 3066.86865f, 3067.05688f, 3067.24512f, 3067.43335f, 3067.62183f, 3067.81006f, 3067.99829f, 3068.18652f, 3068.37476f, 3068.56299f, 3068.75122f, 3068.9397f, 3069.12793f, 3069.31616f, 3069.50439f, 3069.69263f, 3069.88086f, 3070.06934f, 3070.25757f, 3070.4458f, 3070.63403f, 3070.82227f, 3071.0105f, 3071.19873f, 3071.38721f, 3071.57544f, 3071.76367f, 3071.9519f, 3072.14014f, 3072.32837f, 3072.5166f, 3072.70508f, 3072.89331f, 3073.08154f, 3073.26978f, 3073.45801f, 3073.64624f, 3073.83472f, 3074.02295f, 3074.21118f, 3074.39941f, 3074.58765f, 3074.77588f, 3074.96411f, 3075.15259f, 3075.34082f, 3075.52905f, 3075.71729f, 3075.90552f, 3076.09375f, 3076.28198f, 3076.47046f, 3076.65869f, 3076.84692f, 3077.03516f, 3077.22339f, 3077.41162f, 3077.59985f, 3077.78833f, 3077.97656f, 3078.16479f, 3078.35303f, 3078.54126f, 3078.72949f, 3078.91797f, 3079.1062f, 3079.29443f, 3079.48267f, 3079.6709f, 3079.85913f, 3080.04736f, 3080.23584f, 3080.42407f, 3080.6123f, 3080.80054f, 3080.98877f, 3081.177f, 3081.36523f, 3081.55371f, 3081.74194f, 3081.93018f, 3082.11841f, 3082.30664f, 3082.49487f, 3082.68335f, 3082.87158f, 3083.05981f, 3083.24805f, 3083.43628f, 3083.62451f, 3083.81274f, 3084.00122f, 3084.18945f, 3084.37769f};
    test_rebin_case( original_energies, original_counts, new_energies );
  }
  
  {
    printf( "Trying case with coutns at very end\n" );
    std::vector<float> original_energies{0.0163333565f, 0.202889264f, 0.389445186f, 0.576000988f, 0.762556911f, 0.949112773f, 1.13566864f, 1.32222462f, 1.50878036f, 1.69533622f, 1.88189209f, 2.06844783f, 2.25500369f, 2.44155931f, 2.62811542f, 2.81467128f, 3.0012269f, 3.18778276f, 3.37433839f, 3.56089449f, 3.74745011f, 3.93400574f, 4.1205616f, 4.30711746f, 4.49367332f, 4.68022871f, 4.86678457f, 5.05334044f, 5.2398963f, 5.42645216f, 5.61300755f, 5.79956341f, 5.98611879f, 6.17267466f, 6.35923004f, 6.5457859f, 6.73234129f, 6.91889715f, 7.10545301f, 7.2920084f, 7.47856426f, 7.66511965f, 7.85167551f, 8.0382309f, 8.22478676f, 8.41134167f, 8.59789753f, 8.78445339f, 8.9710083f, 9.15756416f, 9.34412003f, 9.53067493f, 9.7172308f, 9.90378571f, 10.0903425f, 10.2768984f, 10.4634533f, 10.6500092f, 10.8365641f, 11.0231199f, 11.2096748f, 11.3962307f, 11.5827856f, 11.7693415f, 11.9558964f, 12.1424522f, 12.3290071f, 12.515563f, 12.7021179f, 12.8886738f, 13.0752287f, 13.2617846f, 13.4483395f, 13.6348953f, 13.8214502f, 14.008007f, 14.194562f, 14.3811169f, 14.5676727f, 14.7542276f, 14.9407835f, 15.1273384f, 15.3138933f, 15.5004492f, 15.6870041f, 15.87356f, 16.0601139f, 16.2466698f, 16.4332237f, 16.6197796f, 16.8063354f, 16.9928894f, 17.1794453f, 17.3660011f, 17.5525551f, 17.7391109f, 17.9256668f, 18.1122208f, 18.2987766f, 18.4853306f, 3037.11963f, 3037.30591f, 3037.49243f, 3037.67871f, 3037.86523f, 3038.05151f, 3038.23828f, 3038.42456f, 3038.61108f, 3038.79736f, 3038.98389f, 3039.17017f, 3039.35669f, 3039.54321f, 3039.72974f, 3039.91602f, 3040.10254f, 3040.28882f, 3040.47534f, 3040.66162f, 3040.84814f, 3041.03467f, 3041.22119f, 3041.40747f, 3041.59399f, 3041.78052f, 3041.9668f, 3042.15332f, 3042.33984f, 3042.52637f, 3042.71265f, 3042.89917f, 3043.08545f, 3043.27197f, 3043.45825f, 3043.64478f, 3043.8313f, 3044.01782f, 3044.2041f, 3044.39062f, 3044.5769f, 3044.76343f, 3044.94971f, 3045.13647f, 3045.32275f, 3045.50928f, 3045.69556f, 3045.88208f, 3046.06836f, 3046.25488f, 3046.44116f, 3046.62793f, 3046.81421f, 3047.00073f, 3047.18701f, 3047.37354f, 3047.56006f, 3047.74634f, 3047.93311f, 3048.11938f, 3048.30591f, 3048.49219f, 3048.67871f, 3048.86499f, 3049.05151f, 3049.23779f, 3049.42456f, 3049.61084f, 3049.79736f, 3049.98364f, 3050.17017f, 3050.35645f, 3050.54297f, 3050.72949f, 3050.91602f, 3051.10229f, 3051.28882f, 3051.4751f, 3051.66162f, 3051.8479f, 3052.03442f, 3052.22095f, 3052.40747f, 3052.59375f, 3052.78027f, 3052.96655f, 3053.15308f, 3053.33936f, 3053.52612f, 3053.71265f, 3053.89893f, 3054.08545f, 3054.27173f, 3054.45825f, 3054.64453f, 3054.83105f, 3055.01758f, 3055.2041f, 3055.39038f};
    std::vector<float> original_counts{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 27, 109, 269, 391, 386, 380, 345, 418, 413, 409, 358, 378, 392, 366, 402, 380, 391, 383, 350, 360, 388, 407, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 22, 19, 2, 8, 11, 1, 2, 5};
    std::vector<float> new_energies{-0.0297551602f, 0.15851362f, 0.346782386f, 0.535051167f, 0.723319948f, 0.911588728f, 1.09985757f, 1.28812635f, 1.47639513f, 1.66466391f, 1.85293269f, 2.04120159f, 2.22947025f, 2.41773891f, 2.60600781f, 2.79427671f, 2.98254538f, 3.17081404f, 3.35908294f, 3.54735184f, 3.7356205f, 3.92388916f, 4.1121583f, 4.30042696f, 4.48869562f, 4.67696428f, 4.86523294f, 5.05350208f, 5.24177074f, 5.43003941f, 5.61830854f, 5.80657721f, 5.99484587f, 6.18311453f, 6.37138319f, 6.55965233f, 6.74792099f, 6.93618965f, 7.12445879f, 7.31272745f, 7.50099611f, 7.68926477f, 7.87753344f, 8.06580162f, 8.25407124f, 8.4423399f, 8.63060856f, 8.81887722f, 9.00714588f, 9.19541454f, 9.3836832f, 9.57195187f, 9.76022053f, 9.94849014f, 10.1367588f, 10.3250275f, 10.5132961f, 10.7015648f, 10.8898335f, 11.0781021f, 11.2663717f, 11.4546404f, 11.642909f, 11.8311777f, 12.0194464f, 12.207715f, 12.3959837f, 12.5842524f, 12.772521f, 12.9607906f, 13.1490593f, 13.337328f, 13.5255966f, 13.7138653f, 13.9021339f, 14.0904026f, 14.2786722f, 14.4669409f, 14.6552095f, 14.8434782f, 15.0317469f, 15.2200155f, 15.4082842f, 15.5965528f, 15.7848215f, 15.9730902f, 16.1613598f, 16.3496284f, 16.537899f, 16.7261677f, 16.9144363f, 17.102705f, 17.2909737f, 17.4792423f, 17.667511f, 17.8557796f, 18.0440483f, 18.232317f, 18.4205856f, 18.6088543f, 3065.92725f, 3066.11548f, 3066.30396f, 3066.49219f, 3066.68042f, 3066.86865f, 3067.05688f, 3067.24512f, 3067.43335f, 3067.62183f, 3067.81006f, 3067.99829f, 3068.18652f, 3068.37476f, 3068.56299f, 3068.75122f, 3068.9397f, 3069.12793f, 3069.31616f, 3069.50439f, 3069.69263f, 3069.88086f, 3070.06934f, 3070.25757f, 3070.4458f, 3070.63403f, 3070.82227f, 3071.0105f, 3071.19873f, 3071.38721f, 3071.57544f, 3071.76367f, 3071.9519f, 3072.14014f, 3072.32837f, 3072.5166f, 3072.70508f, 3072.89331f, 3073.08154f, 3073.26978f, 3073.45801f, 3073.64624f, 3073.83472f, 3074.02295f, 3074.21118f, 3074.39941f, 3074.58765f, 3074.77588f, 3074.96411f, 3075.15259f, 3075.34082f, 3075.52905f, 3075.71729f, 3075.90552f, 3076.09375f, 3076.28198f, 3076.47046f, 3076.65869f, 3076.84692f, 3077.03516f, 3077.22339f, 3077.41162f, 3077.59985f, 3077.78833f, 3077.97656f, 3078.16479f, 3078.35303f, 3078.54126f, 3078.72949f, 3078.91797f, 3079.1062f, 3079.29443f, 3079.48267f, 3079.6709f, 3079.85913f, 3080.04736f, 3080.23584f, 3080.42407f, 3080.6123f, 3080.80054f, 3080.98877f, 3081.177f, 3081.36523f, 3081.55371f, 3081.74194f, 3081.93018f, 3082.11841f, 3082.30664f, 3082.49487f, 3082.68335f, 3082.87158f, 3083.05981f, 3083.24805f, 3083.43628f, 3083.62451f, 3083.81274f, 3084.00122f, 3084.18945f, 3084.37769f};
    test_rebin_case( original_energies, original_counts, new_energies );
  }
  
  
  {
    printf( "Trying case with counts starting second bin\n" );
    std::vector<float> original_energies{0.190193534f, 0.377671033f, 0.565148532f, 0.752626061f, 0.940103471f, 1.127581f, 1.31505847f, 1.50253594f, 1.69001341f, 1.87749088f, 2.06496835f, 2.25244594f, 2.43992352f, 2.62740064f, 2.81487799f, 3.00235558f, 3.18983316f, 3.37731075f, 3.56478763f, 3.75226521f, 3.9397428f, 4.12722015f, 4.31469774f, 4.50217533f, 4.68965292f, 4.87712955f, 5.06460714f, 5.25208473f, 5.43956232f, 5.62703943f, 5.81451654f, 6.00199413f, 6.18947172f, 6.37694883f, 6.56442642f, 6.75190353f, 6.93938112f, 7.12685823f, 7.31433582f, 7.50181341f, 7.68929005f, 7.87676764f, 8.06424427f, 8.25172138f, 8.43919945f, 8.62667656f, 8.81415462f, 9.00163078f, 9.18910885f, 9.37658596f, 9.56406307f, 9.75154114f, 9.9390173f, 10.1264954f, 10.3139725f, 10.5014496f, 10.6889267f, 10.8764038f, 11.0638819f, 11.251359f, 11.4388351f, 11.6263132f, 11.8137903f, 12.0012684f, 12.1887445f, 12.3762217f, 12.5636997f, 12.7511768f, 12.9386539f, 13.1261311f, 13.3136082f, 13.5010853f, 13.6885624f, 13.8760405f, 14.0635166f, 14.2509937f, 14.4384718f, 14.6259489f, 14.813426f, 15.0009031f, 15.1883802f, 15.3758574f, 15.5633345f, 15.7508116f, 15.9382887f, 16.1257668f, 16.313242f, 16.500721f, 16.6881981f, 16.8756752f, 17.0631504f, 17.2506275f, 17.4381065f, 17.6255836f, 17.8130608f, 18.000536f, 18.188015f, 18.3754921f, 18.5629692f, 18.7504463f, 3052.72852f, 3052.91602f, 3053.10352f, 3053.29077f, 3053.47827f, 3053.66577f, 3053.85327f, 3054.04028f, 3054.22778f, 3054.41528f, 3054.60254f, 3054.79004f, 3054.97754f, 3055.16504f, 3055.35229f, 3055.53979f, 3055.72729f, 3055.91479f, 3056.10181f, 3056.28931f, 3056.47681f, 3056.66406f, 3056.85156f, 3057.03906f, 3057.22656f, 3057.41382f, 3057.60132f, 3057.78882f, 3057.97632f, 3058.16333f, 3058.35083f, 3058.53833f, 3058.72583f, 3058.91309f, 3059.10059f, 3059.28809f, 3059.47534f, 3059.66284f, 3059.85034f, 3060.03784f, 3060.22485f, 3060.41235f, 3060.59985f, 3060.78735f, 3060.97461f, 3061.16211f, 3061.34961f, 3061.53711f, 3061.72437f, 3061.91187f, 3062.09937f, 3062.28638f, 3062.47388f, 3062.66138f, 3062.84888f, 3063.03613f, 3063.22363f, 3063.41113f, 3063.59863f, 3063.78589f, 3063.97339f, 3064.16089f, 3064.3479f, 3064.5354f, 3064.7229f, 3064.9104f, 3065.09766f, 3065.28516f, 3065.47266f, 3065.66016f, 3065.84741f, 3066.03491f, 3066.22217f, 3066.40967f, 3066.59692f, 3066.78442f, 3066.97192f, 3067.15918f, 3067.34668f, 3067.53418f, 3067.72168f, 3067.90894f, 3068.09644f, 3068.28369f, 3068.47119f, 3068.65845f, 3068.84595f, 3069.03345f, 3069.2207f, 3069.4082f, 3069.5957f, 3069.7832f, 3069.97046f, 3070.15796f, 3070.34521f, 3070.53271f, 3070.71997f, 3070.90747f, 3071.09497f};
    std::vector<float> original_counts{0, 15, 18, 19, 20, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 19, 37, 87, 120, 142, 153, 162, 152, 156, 153, 161, 142, 154, 170, 141, 125, 158, 143, 159, 128, 155, 153, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
    std::vector<float> new_energies{-0.0297551602f, 0.15851362f, 0.346782386f, 0.535051167f, 0.723319948f, 0.911588728f, 1.09985757f, 1.28812635f, 1.47639513f, 1.66466391f, 1.85293269f, 2.04120159f, 2.22947025f, 2.41773891f, 2.60600781f, 2.79427671f, 2.98254538f, 3.17081404f, 3.35908294f, 3.54735184f, 3.7356205f, 3.92388916f, 4.1121583f, 4.30042696f, 4.48869562f, 4.67696428f, 4.86523294f, 5.05350208f, 5.24177074f, 5.43003941f, 5.61830854f, 5.80657721f, 5.99484587f, 6.18311453f, 6.37138319f, 6.55965233f, 6.74792099f, 6.93618965f, 7.12445879f, 7.31272745f, 7.50099611f, 7.68926477f, 7.87753344f, 8.06580162f, 8.25407124f, 8.4423399f, 8.63060856f, 8.81887722f, 9.00714588f, 9.19541454f, 9.3836832f, 9.57195187f, 9.76022053f, 9.94849014f, 10.1367588f, 10.3250275f, 10.5132961f, 10.7015648f, 10.8898335f, 11.0781021f, 11.2663717f, 11.4546404f, 11.642909f, 11.8311777f, 12.0194464f, 12.207715f, 12.3959837f, 12.5842524f, 12.772521f, 12.9607906f, 13.1490593f, 13.337328f, 13.5255966f, 13.7138653f, 13.9021339f, 14.0904026f, 14.2786722f, 14.4669409f, 14.6552095f, 14.8434782f, 15.0317469f, 15.2200155f, 15.4082842f, 15.5965528f, 15.7848215f, 15.9730902f, 16.1613598f, 16.3496284f, 16.537899f, 16.7261677f, 16.9144363f, 17.102705f, 17.2909737f, 17.4792423f, 17.667511f, 17.8557796f, 18.0440483f, 18.232317f, 18.4205856f, 18.6088543f, 3065.92725f, 3066.11548f, 3066.30396f, 3066.49219f, 3066.68042f, 3066.86865f, 3067.05688f, 3067.24512f, 3067.43335f, 3067.62183f, 3067.81006f, 3067.99829f, 3068.18652f, 3068.37476f, 3068.56299f, 3068.75122f, 3068.9397f, 3069.12793f, 3069.31616f, 3069.50439f, 3069.69263f, 3069.88086f, 3070.06934f, 3070.25757f, 3070.4458f, 3070.63403f, 3070.82227f, 3071.0105f, 3071.19873f, 3071.38721f, 3071.57544f, 3071.76367f, 3071.9519f, 3072.14014f, 3072.32837f, 3072.5166f, 3072.70508f, 3072.89331f, 3073.08154f, 3073.26978f, 3073.45801f, 3073.64624f, 3073.83472f, 3074.02295f, 3074.21118f, 3074.39941f, 3074.58765f, 3074.77588f, 3074.96411f, 3075.15259f, 3075.34082f, 3075.52905f, 3075.71729f, 3075.90552f, 3076.09375f, 3076.28198f, 3076.47046f, 3076.65869f, 3076.84692f, 3077.03516f, 3077.22339f, 3077.41162f, 3077.59985f, 3077.78833f, 3077.97656f, 3078.16479f, 3078.35303f, 3078.54126f, 3078.72949f, 3078.91797f, 3079.1062f, 3079.29443f, 3079.48267f, 3079.6709f, 3079.85913f, 3080.04736f, 3080.23584f, 3080.42407f, 3080.6123f, 3080.80054f, 3080.98877f, 3081.177f, 3081.36523f, 3081.55371f, 3081.74194f, 3081.93018f, 3082.11841f, 3082.30664f, 3082.49487f, 3082.68335f, 3082.87158f, 3083.05981f, 3083.24805f, 3083.43628f, 3083.62451f, 3083.81274f, 3084.00122f, 3084.18945f, 3084.37769f};
    test_rebin_case( original_energies, original_counts, new_energies );
  }
  
  {
    printf( "Trying case with counts starting third bin\n" );
    std::vector<float> original_energies{0.0410209f, 0.2281221f, 0.4152233f, 0.602324486f, 0.789425671f, 0.976526797f, 1.16362798f, 1.35072911f, 1.53783035f, 1.72493148f, 1.9120326f, 2.09913373f, 2.28623509f, 2.47333598f, 2.66043711f, 2.84753847f, 3.0346396f, 3.22174048f, 3.40884185f, 3.59594297f, 3.78304386f, 3.97014523f, 4.15724611f, 4.344347f, 4.53144836f, 4.71854925f, 4.90565062f, 5.0927515f, 5.27985239f, 5.46695375f, 5.65405512f, 5.84115553f, 6.02825689f, 6.21535826f, 6.40245867f, 6.58956003f, 6.7766614f, 6.96376181f, 7.15086317f, 7.33796453f, 7.52506495f, 7.71216631f, 7.8992672f, 8.08636951f, 8.27346897f, 8.46057034f, 8.6476717f, 8.83477306f, 9.02187347f, 9.20897484f, 9.39607525f, 9.58317661f, 9.77027702f, 9.95737839f, 10.1444798f, 10.3315811f, 10.5186806f, 10.7057819f, 10.8928833f, 11.0799847f, 11.2670851f, 11.4541864f, 11.6412868f, 11.8283873f, 12.0154886f, 12.20259f, 12.3896904f, 12.5767908f, 12.7638922f, 12.9509926f, 13.1380939f, 13.3251953f, 13.5122957f, 13.6993961f, 13.8864975f, 14.0735979f, 14.2606993f, 14.4478006f, 14.634901f, 14.8220015f, 15.0091019f, 15.1962032f, 15.3833046f, 15.570405f, 15.7575064f, 15.9446058f, 16.1317081f, 16.3188095f, 16.505909f, 16.6930084f, 16.8801098f, 17.0672112f, 17.2543125f, 17.4414139f, 17.6285133f, 17.8156147f, 18.0027161f, 18.1898174f, 18.3769169f, 18.5640163f, 3046.37109f, 3046.55811f, 3046.74512f, 3046.93213f, 3047.11914f, 3047.3064f, 3047.49316f, 3047.68018f, 3047.86743f, 3048.05444f, 3048.24121f, 3048.42847f, 3048.61548f, 3048.80225f, 3048.9895f, 3049.17651f, 3049.36353f, 3049.55054f, 3049.73755f, 3049.92456f, 3050.11157f, 3050.29858f, 3050.48584f, 3050.67261f, 3050.85986f, 3051.04688f, 3051.23364f, 3051.4209f, 3051.60791f, 3051.79468f, 3051.98193f, 3052.16895f, 3052.35571f, 3052.54297f, 3052.72998f, 3052.91724f, 3053.104f, 3053.29102f, 3053.47827f, 3053.66504f, 3053.85205f, 3054.03931f, 3054.22607f, 3054.41309f, 3054.60034f, 3054.78711f, 3054.97437f, 3055.16138f, 3055.34839f, 3055.5354f, 3055.72241f, 3055.90942f, 3056.09644f, 3056.28345f, 3056.4707f, 3056.65747f, 3056.84448f, 3057.03174f, 3057.21851f, 3057.40552f, 3057.59277f, 3057.77954f, 3057.96655f, 3058.15381f, 3058.34082f, 3058.52783f, 3058.71484f, 3058.90186f, 3059.08887f, 3059.27588f, 3059.46289f, 3059.6499f, 3059.83691f, 3060.02393f, 3060.21094f, 3060.39795f, 3060.58521f, 3060.77222f, 3060.95898f, 3061.14624f, 3061.33325f, 3061.52002f, 3061.70728f, 3061.89429f, 3062.0813f, 3062.26831f, 3062.45532f, 3062.64233f, 3062.82935f, 3063.01636f, 3063.20361f, 3063.39038f, 3063.57739f, 3063.76465f, 3063.95142f, 3064.13867f, 3064.32568f, 3064.51245f, 3064.69971f};
    std::vector<float> original_counts{0, 0, 33, 34, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 9, 42, 163, 308, 396, 450, 428, 434, 428, 417, 422, 398, 438, 381, 382, 417, 416, 380, 399, 395, 373, 380, 383, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0};
    std::vector<float> new_energies{-0.0297551602f, 0.15851362f, 0.346782386f, 0.535051167f, 0.723319948f, 0.911588728f, 1.09985757f, 1.28812635f, 1.47639513f, 1.66466391f, 1.85293269f, 2.04120159f, 2.22947025f, 2.41773891f, 2.60600781f, 2.79427671f, 2.98254538f, 3.17081404f, 3.35908294f, 3.54735184f, 3.7356205f, 3.92388916f, 4.1121583f, 4.30042696f, 4.48869562f, 4.67696428f, 4.86523294f, 5.05350208f, 5.24177074f, 5.43003941f, 5.61830854f, 5.80657721f, 5.99484587f, 6.18311453f, 6.37138319f, 6.55965233f, 6.74792099f, 6.93618965f, 7.12445879f, 7.31272745f, 7.50099611f, 7.68926477f, 7.87753344f, 8.06580162f, 8.25407124f, 8.4423399f, 8.63060856f, 8.81887722f, 9.00714588f, 9.19541454f, 9.3836832f, 9.57195187f, 9.76022053f, 9.94849014f, 10.1367588f, 10.3250275f, 10.5132961f, 10.7015648f, 10.8898335f, 11.0781021f, 11.2663717f, 11.4546404f, 11.642909f, 11.8311777f, 12.0194464f, 12.207715f, 12.3959837f, 12.5842524f, 12.772521f, 12.9607906f, 13.1490593f, 13.337328f, 13.5255966f, 13.7138653f, 13.9021339f, 14.0904026f, 14.2786722f, 14.4669409f, 14.6552095f, 14.8434782f, 15.0317469f, 15.2200155f, 15.4082842f, 15.5965528f, 15.7848215f, 15.9730902f, 16.1613598f, 16.3496284f, 16.537899f, 16.7261677f, 16.9144363f, 17.102705f, 17.2909737f, 17.4792423f, 17.667511f, 17.8557796f, 18.0440483f, 18.232317f, 18.4205856f, 18.6088543f, 3065.92725f, 3066.11548f, 3066.30396f, 3066.49219f, 3066.68042f, 3066.86865f, 3067.05688f, 3067.24512f, 3067.43335f, 3067.62183f, 3067.81006f, 3067.99829f, 3068.18652f, 3068.37476f, 3068.56299f, 3068.75122f, 3068.9397f, 3069.12793f, 3069.31616f, 3069.50439f, 3069.69263f, 3069.88086f, 3070.06934f, 3070.25757f, 3070.4458f, 3070.63403f, 3070.82227f, 3071.0105f, 3071.19873f, 3071.38721f, 3071.57544f, 3071.76367f, 3071.9519f, 3072.14014f, 3072.32837f, 3072.5166f, 3072.70508f, 3072.89331f, 3073.08154f, 3073.26978f, 3073.45801f, 3073.64624f, 3073.83472f, 3074.02295f, 3074.21118f, 3074.39941f, 3074.58765f, 3074.77588f, 3074.96411f, 3075.15259f, 3075.34082f, 3075.52905f, 3075.71729f, 3075.90552f, 3076.09375f, 3076.28198f, 3076.47046f, 3076.65869f, 3076.84692f, 3077.03516f, 3077.22339f, 3077.41162f, 3077.59985f, 3077.78833f, 3077.97656f, 3078.16479f, 3078.35303f, 3078.54126f, 3078.72949f, 3078.91797f, 3079.1062f, 3079.29443f, 3079.48267f, 3079.6709f, 3079.85913f, 3080.04736f, 3080.23584f, 3080.42407f, 3080.6123f, 3080.80054f, 3080.98877f, 3081.177f, 3081.36523f, 3081.55371f, 3081.74194f, 3081.93018f, 3082.11841f, 3082.30664f, 3082.49487f, 3082.68335f, 3082.87158f, 3083.05981f, 3083.24805f, 3083.43628f, 3083.62451f, 3083.81274f, 3084.00122f, 3084.18945f, 3084.37769f};
    std::vector<float> resulting_counts;
    test_rebin_case( original_energies, original_counts, new_energies );
  }
  
  {
    printf( "Trying case with counts in second to last bin\n" );
    std::vector<float> original_energies{0.221937045f, 0.409898341f, 0.597859621f, 0.785820901f, 0.973782182f, 1.1617434f, 1.34970474f, 1.53766584f, 1.72562718f, 1.9135884f, 2.10154939f, 2.28951073f, 2.47747183f, 2.66543317f, 2.85339403f, 3.04135537f, 3.22931647f, 3.41727781f, 3.60523891f, 3.79319978f, 3.98116112f, 4.16912222f, 4.3570838f, 4.54504442f, 4.733006f, 4.92096663f, 5.1089282f, 5.29688883f, 5.48484993f, 5.67281103f, 5.86077213f, 6.04873323f, 6.23669434f, 6.42465496f, 6.61261606f, 6.80057716f, 6.98853827f, 7.17649889f, 7.36445999f, 7.55242109f, 7.74038172f, 7.92834282f, 8.11630344f, 8.30426407f, 8.49222565f, 8.68018723f, 8.8681469f, 9.05610847f, 9.2440691f, 9.43202972f, 9.61999035f, 9.80795193f, 9.99591351f, 10.1838732f, 10.3718348f, 10.5597954f, 10.747756f, 10.9357166f, 11.1236773f, 11.3116379f, 11.4995985f, 11.6875601f, 11.8755207f, 12.0634813f, 12.251442f, 12.4394026f, 12.6273632f, 12.8153238f, 13.0032854f, 13.191246f, 13.3792057f, 13.5671673f, 13.7551279f, 13.9430876f, 14.1310492f, 14.3190098f, 14.5069695f, 14.694931f, 14.8828917f, 15.0708523f, 15.258812f, 15.4467735f, 15.6347342f, 15.8226938f, 16.0106544f, 16.1986141f, 16.3865757f, 16.5745373f, 16.7624969f, 16.9504585f, 17.1384182f, 17.3263779f, 17.5143375f, 17.7022991f, 17.8902607f, 18.0782204f, 18.2661819f, 18.4541416f, 18.6421013f, 18.830061f, 3060.00439f, 3060.19214f, 3060.37988f, 3060.56787f, 3060.75562f, 3060.94336f, 3061.1311f, 3061.31885f, 3061.50684f, 3061.69458f, 3061.88257f, 3062.07031f, 3062.25806f, 3062.44604f, 3062.63354f, 3062.82153f, 3063.00928f, 3063.19727f, 3063.38501f, 3063.57275f, 3063.76074f, 3063.94849f, 3064.13647f, 3064.32397f, 3064.51172f, 3064.69971f, 3064.88745f, 3065.07544f, 3065.26318f, 3065.45093f, 3065.63892f, 3065.82666f, 3066.0144f, 3066.20215f, 3066.39014f, 3066.57788f, 3066.76562f, 3066.95361f, 3067.14136f, 3067.32935f, 3067.51709f, 3067.70459f, 3067.89258f, 3068.08032f, 3068.26831f, 3068.45605f, 3068.6438f, 3068.83179f, 3069.01953f, 3069.20752f, 3069.39502f, 3069.58301f, 3069.77075f, 3069.9585f, 3070.14648f, 3070.33423f, 3070.52222f, 3070.70996f, 3070.89771f, 3071.08545f, 3071.27319f, 3071.46118f, 3071.64893f, 3071.83667f, 3072.02466f, 3072.2124f, 3072.40039f, 3072.58813f, 3072.77563f, 3072.96362f, 3073.15137f, 3073.33936f, 3073.5271f, 3073.71509f, 3073.90283f, 3074.09058f, 3074.27856f, 3074.46606f, 3074.65405f, 3074.8418f, 3075.02954f, 3075.21753f, 3075.40527f, 3075.59326f, 3075.78101f, 3075.96875f, 3076.15649f, 3076.34424f, 3076.53223f, 3076.71997f, 3076.90796f, 3077.0957f, 3077.28345f, 3077.47144f, 3077.65918f, 3077.84692f, 3078.03467f, 3078.22241f, 3078.4104f};
    std::vector<float> original_counts{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 99, 0};
    std::vector<float> new_energies{-0.0297551602f, 0.15851362f, 0.346782386f, 0.535051167f, 0.723319948f, 0.911588728f, 1.09985757f, 1.28812635f, 1.47639513f, 1.66466391f, 1.85293269f, 2.04120159f, 2.22947025f, 2.41773891f, 2.60600781f, 2.79427671f, 2.98254538f, 3.17081404f, 3.35908294f, 3.54735184f, 3.7356205f, 3.92388916f, 4.1121583f, 4.30042696f, 4.48869562f, 4.67696428f, 4.86523294f, 5.05350208f, 5.24177074f, 5.43003941f, 5.61830854f, 5.80657721f, 5.99484587f, 6.18311453f, 6.37138319f, 6.55965233f, 6.74792099f, 6.93618965f, 7.12445879f, 7.31272745f, 7.50099611f, 7.68926477f, 7.87753344f, 8.06580162f, 8.25407124f, 8.4423399f, 8.63060856f, 8.81887722f, 9.00714588f, 9.19541454f, 9.3836832f, 9.57195187f, 9.76022053f, 9.94849014f, 10.1367588f, 10.3250275f, 10.5132961f, 10.7015648f, 10.8898335f, 11.0781021f, 11.2663717f, 11.4546404f, 11.642909f, 11.8311777f, 12.0194464f, 12.207715f, 12.3959837f, 12.5842524f, 12.772521f, 12.9607906f, 13.1490593f, 13.337328f, 13.5255966f, 13.7138653f, 13.9021339f, 14.0904026f, 14.2786722f, 14.4669409f, 14.6552095f, 14.8434782f, 15.0317469f, 15.2200155f, 15.4082842f, 15.5965528f, 15.7848215f, 15.9730902f, 16.1613598f, 16.3496284f, 16.537899f, 16.7261677f, 16.9144363f, 17.102705f, 17.2909737f, 17.4792423f, 17.667511f, 17.8557796f, 18.0440483f, 18.232317f, 18.4205856f, 18.6088543f, 3065.92725f, 3066.11548f, 3066.30396f, 3066.49219f, 3066.68042f, 3066.86865f, 3067.05688f, 3067.24512f, 3067.43335f, 3067.62183f, 3067.81006f, 3067.99829f, 3068.18652f, 3068.37476f, 3068.56299f, 3068.75122f, 3068.9397f, 3069.12793f, 3069.31616f, 3069.50439f, 3069.69263f, 3069.88086f, 3070.06934f, 3070.25757f, 3070.4458f, 3070.63403f, 3070.82227f, 3071.0105f, 3071.19873f, 3071.38721f, 3071.57544f, 3071.76367f, 3071.9519f, 3072.14014f, 3072.32837f, 3072.5166f, 3072.70508f, 3072.89331f, 3073.08154f, 3073.26978f, 3073.45801f, 3073.64624f, 3073.83472f, 3074.02295f, 3074.21118f, 3074.39941f, 3074.58765f, 3074.77588f, 3074.96411f, 3075.15259f, 3075.34082f, 3075.52905f, 3075.71729f, 3075.90552f, 3076.09375f, 3076.28198f, 3076.47046f, 3076.65869f, 3076.84692f, 3077.03516f, 3077.22339f, 3077.41162f, 3077.59985f, 3077.78833f, 3077.97656f, 3078.16479f, 3078.35303f, 3078.54126f, 3078.72949f, 3078.91797f, 3079.1062f, 3079.29443f, 3079.48267f, 3079.6709f, 3079.85913f, 3080.04736f, 3080.23584f, 3080.42407f, 3080.6123f, 3080.80054f, 3080.98877f, 3081.177f, 3081.36523f, 3081.55371f, 3081.74194f, 3081.93018f, 3082.11841f, 3082.30664f, 3082.49487f, 3082.68335f, 3082.87158f, 3083.05981f, 3083.24805f, 3083.43628f, 3083.62451f, 3083.81274f, 3084.00122f, 3084.18945f, 3084.37769f};
    test_rebin_case( original_energies, original_counts, new_energies );
  }
  
  {
    printf( "Trying case with counts in last few bins\n" );
    std::vector<float> original_energies{0.0961009115f, 0.282646596f, 0.469192237f, 0.655737936f, 0.842283547f, 1.0288291f, 1.21537471f, 1.40192032f, 1.58846593f, 1.77501142f, 1.96155691f, 2.14810228f, 2.33464789f, 2.52119327f, 2.70773864f, 2.89428425f, 3.08082962f, 3.26737499f, 3.4539206f, 3.64046574f, 3.82701111f, 4.01355648f, 4.20010185f, 4.38664722f, 4.5731926f, 4.75973749f, 4.94628286f, 5.13282824f, 5.31937313f, 5.5059185f, 5.69246387f, 5.87900877f, 6.06555414f, 6.25209951f, 6.43864441f, 6.62518978f, 6.81173468f, 6.99827957f, 7.18482494f, 7.37136984f, 7.55791473f, 7.74446011f, 7.931005f, 8.1175499f, 8.30409431f, 8.49063969f, 8.6771841f, 8.86372948f, 9.05027485f, 9.23681927f, 9.42336369f, 9.60990906f, 9.79645348f, 9.98299789f, 10.1695433f, 10.3560886f, 10.5426331f, 10.7291784f, 10.9157228f, 11.1022673f, 11.2888126f, 11.4753561f, 11.6619005f, 11.8484459f, 12.0349903f, 12.2215347f, 12.4080801f, 12.5946245f, 12.7811689f, 12.9677134f, 13.1542578f, 13.3408022f, 13.5273476f, 13.713891f, 13.9004354f, 14.0869808f, 14.2735243f, 14.4600687f, 14.6466141f, 14.8331575f, 15.019702f, 15.2062473f, 15.3927908f, 15.5793352f, 15.7658796f, 15.952424f, 16.1389694f, 16.3255138f, 16.5120564f, 16.6986008f, 16.8851471f, 17.0716896f, 17.258234f, 17.4447784f, 17.631321f, 17.8178673f, 18.0044117f, 18.1909542f, 18.3774986f, 18.564043f, 3035.78027f, 3035.96655f, 3036.15283f, 3036.33911f, 3036.52539f, 3036.71167f, 3036.89819f, 3037.08447f, 3037.27075f, 3037.45679f, 3037.64307f, 3037.82935f, 3038.01562f, 3038.2019f, 3038.38818f, 3038.57446f, 3038.76074f, 3038.94727f, 3039.1333f, 3039.31958f, 3039.50586f, 3039.69214f, 3039.87842f, 3040.0647f, 3040.25098f, 3040.43726f, 3040.62329f, 3040.80957f, 3040.99609f, 3041.18237f, 3041.36865f, 3041.55493f, 3041.74121f, 3041.92749f, 3042.11377f, 3042.2998f, 3042.48608f, 3042.67236f, 3042.85864f, 3043.04517f, 3043.23145f, 3043.41772f, 3043.604f, 3043.79028f, 3043.97632f, 3044.1626f, 3044.34888f, 3044.53516f, 3044.72144f, 3044.90771f, 3045.09424f, 3045.28052f, 3045.46655f, 3045.65283f, 3045.83911f, 3046.02539f, 3046.21167f, 3046.39795f, 3046.58423f, 3046.77051f, 3046.95679f, 3047.14307f, 3047.32935f, 3047.51562f, 3047.7019f, 3047.88818f, 3048.07446f, 3048.26074f, 3048.44702f, 3048.63306f, 3048.81934f, 3049.00562f, 3049.19214f, 3049.37842f, 3049.5647f, 3049.75098f, 3049.93726f, 3050.12354f, 3050.30957f, 3050.49585f, 3050.68213f, 3050.86841f, 3051.05469f, 3051.24121f, 3051.42749f, 3051.61377f, 3051.7998f, 3051.98608f, 3052.17236f, 3052.35864f, 3052.54492f, 3052.7312f, 3052.91748f, 3053.10376f, 3053.29028f, 3053.47632f, 3053.6626f, 3053.84888f, 3054.03516f};
    std::vector<float> original_counts{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 2, 17, 72, 126, 191, 225, 201, 224, 223, 225, 232, 208, 191, 213, 183, 199, 194, 200, 222, 208, 206, 206, 167, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 99, 0, 7, 99};
    std::vector<float> new_energies{-0.0297551602f, 0.15851362f, 0.346782386f, 0.535051167f, 0.723319948f, 0.911588728f, 1.09985757f, 1.28812635f, 1.47639513f, 1.66466391f, 1.85293269f, 2.04120159f, 2.22947025f, 2.41773891f, 2.60600781f, 2.79427671f, 2.98254538f, 3.17081404f, 3.35908294f, 3.54735184f, 3.7356205f, 3.92388916f, 4.1121583f, 4.30042696f, 4.48869562f, 4.67696428f, 4.86523294f, 5.05350208f, 5.24177074f, 5.43003941f, 5.61830854f, 5.80657721f, 5.99484587f, 6.18311453f, 6.37138319f, 6.55965233f, 6.74792099f, 6.93618965f, 7.12445879f, 7.31272745f, 7.50099611f, 7.68926477f, 7.87753344f, 8.06580162f, 8.25407124f, 8.4423399f, 8.63060856f, 8.81887722f, 9.00714588f, 9.19541454f, 9.3836832f, 9.57195187f, 9.76022053f, 9.94849014f, 10.1367588f, 10.3250275f, 10.5132961f, 10.7015648f, 10.8898335f, 11.0781021f, 11.2663717f, 11.4546404f, 11.642909f, 11.8311777f, 12.0194464f, 12.207715f, 12.3959837f, 12.5842524f, 12.772521f, 12.9607906f, 13.1490593f, 13.337328f, 13.5255966f, 13.7138653f, 13.9021339f, 14.0904026f, 14.2786722f, 14.4669409f, 14.6552095f, 14.8434782f, 15.0317469f, 15.2200155f, 15.4082842f, 15.5965528f, 15.7848215f, 15.9730902f, 16.1613598f, 16.3496284f, 16.537899f, 16.7261677f, 16.9144363f, 17.102705f, 17.2909737f, 17.4792423f, 17.667511f, 17.8557796f, 18.0440483f, 18.232317f, 18.4205856f, 18.6088543f, 3065.92725f, 3066.11548f, 3066.30396f, 3066.49219f, 3066.68042f, 3066.86865f, 3067.05688f, 3067.24512f, 3067.43335f, 3067.62183f, 3067.81006f, 3067.99829f, 3068.18652f, 3068.37476f, 3068.56299f, 3068.75122f, 3068.9397f, 3069.12793f, 3069.31616f, 3069.50439f, 3069.69263f, 3069.88086f, 3070.06934f, 3070.25757f, 3070.4458f, 3070.63403f, 3070.82227f, 3071.0105f, 3071.19873f, 3071.38721f, 3071.57544f, 3071.76367f, 3071.9519f, 3072.14014f, 3072.32837f, 3072.5166f, 3072.70508f, 3072.89331f, 3073.08154f, 3073.26978f, 3073.45801f, 3073.64624f, 3073.83472f, 3074.02295f, 3074.21118f, 3074.39941f, 3074.58765f, 3074.77588f, 3074.96411f, 3075.15259f, 3075.34082f, 3075.52905f, 3075.71729f, 3075.90552f, 3076.09375f, 3076.28198f, 3076.47046f, 3076.65869f, 3076.84692f, 3077.03516f, 3077.22339f, 3077.41162f, 3077.59985f, 3077.78833f, 3077.97656f, 3078.16479f, 3078.35303f, 3078.54126f, 3078.72949f, 3078.91797f, 3079.1062f, 3079.29443f, 3079.48267f, 3079.6709f, 3079.85913f, 3080.04736f, 3080.23584f, 3080.42407f, 3080.6123f, 3080.80054f, 3080.98877f, 3081.177f, 3081.36523f, 3081.55371f, 3081.74194f, 3081.93018f, 3082.11841f, 3082.30664f, 3082.49487f, 3082.68335f, 3082.87158f, 3083.05981f, 3083.24805f, 3083.43628f, 3083.62451f, 3083.81274f, 3084.00122f, 3084.18945f, 3084.37769f};
    std::vector<float> resulting_counts;
    test_rebin_case( original_energies, original_counts, new_energies );
  }
  
  {
    std::vector<float> original_energies{-0.123889551f, 0.0645787269f, 0.253046989f, 0.441515207f, 0.629983425f, 0.818451583f, 1.00691974f, 1.19538784f, 1.38385594f, 1.57232416f, 1.76079214f, 1.94926012f, 2.13772845f, 2.32619619f, 2.51466417f, 2.70313239f, 2.89160013f, 3.08006787f, 3.26853585f, 3.45700383f, 3.64547157f, 3.83393931f, 4.02240705f, 4.21087456f, 4.39934254f, 4.58781004f, 4.77627802f, 4.96474552f, 5.15321302f, 5.341681f, 5.53014851f, 5.71861553f, 5.90708351f, 6.09555101f, 6.28401804f, 6.47248602f, 6.66095352f, 6.84942055f, 7.03788805f, 7.22635555f, 7.41482258f, 7.60329008f, 7.79175758f, 7.98022461f, 8.16869068f, 8.35715866f, 8.54562569f, 8.73409271f, 8.92256069f, 9.11102676f, 9.29949379f, 9.48796177f, 9.67642784f, 9.86489487f, 10.0533628f, 10.2418289f, 10.4302959f, 10.6187639f, 10.80723f, 10.995697f, 11.184164f, 11.3726301f, 11.5610971f, 11.7495642f, 11.9380312f, 12.1264973f, 12.3149643f, 12.5034313f, 12.6918974f, 12.8803644f, 13.0688305f, 13.2572975f, 13.4457645f, 13.6342306f, 13.8226967f, 14.0111637f, 14.1996298f, 14.3880959f, 14.5765629f, 14.765029f, 14.953495f, 15.1419621f, 15.3304281f, 15.5188942f, 15.7073612f, 15.8958263f, 16.0842934f, 16.2727604f, 16.4612255f, 16.6496906f, 16.8381577f, 17.0266228f, 17.2150898f, 17.4035568f, 17.5920219f, 17.7804871f, 17.9689541f, 18.1574192f, 18.3458862f, 18.5343513f, 3065.85278f, 3066.04077f, 3066.229f, 3066.41699f, 3066.60522f, 3066.79321f, 3066.9812f, 3067.16943f, 3067.35742f, 3067.54541f, 3067.73364f, 3067.92163f, 3068.10986f, 3068.29785f, 3068.48584f, 3068.67407f, 3068.86206f, 3069.05005f, 3069.23828f, 3069.42627f, 3069.6145f, 3069.80249f, 3069.99048f, 3070.17871f, 3070.3667f, 3070.55469f, 3070.74268f, 3070.93066f, 3071.11865f, 3071.30688f, 3071.49487f, 3071.68311f, 3071.87109f, 3072.05908f, 3072.24731f, 3072.4353f, 3072.62329f, 3072.81152f, 3072.99951f, 3073.18774f, 3073.37573f, 3073.56372f, 3073.75195f, 3073.93994f, 3074.12793f, 3074.31616f, 3074.50415f, 3074.69238f, 3074.88037f, 3075.06836f, 3075.25659f, 3075.44458f, 3075.63257f, 3075.8208f, 3076.00879f, 3076.19678f, 3076.38477f, 3076.57275f, 3076.76099f, 3076.94897f, 3077.13696f, 3077.3252f, 3077.51318f, 3077.70117f, 3077.8894f, 3078.07739f, 3078.26562f, 3078.45361f, 3078.6416f, 3078.82983f, 3079.01782f, 3079.20581f, 3079.39404f, 3079.58203f, 3079.77026f, 3079.95825f, 3080.14624f, 3080.33447f, 3080.52246f, 3080.71045f, 3080.89868f, 3081.08667f, 3081.27466f, 3081.46289f, 3081.65088f, 3081.83887f, 3082.02686f, 3082.21484f, 3082.40308f, 3082.59106f, 3082.77905f, 3082.96729f, 3083.15527f, 3083.34351f, 3083.53149f, 3083.71948f, 3083.90771f, 3084.0957f, 3084.28369f};
    std::vector<float> original_counts{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 2, 14, 83, 195, 317, 341, 340, 358, 336, 366, 386, 330, 346, 332, 347, 351, 317, 351, 290, 332, 344, 288, 289, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 3, 0};
    std::vector<float> new_energies{-0.0297551602f, 0.15851362f, 0.346782386f, 0.535051167f, 0.723319948f, 0.911588728f, 1.09985757f, 1.28812635f, 1.47639513f, 1.66466391f, 1.85293269f, 2.04120159f, 2.22947025f, 2.41773891f, 2.60600781f, 2.79427671f, 2.98254538f, 3.17081404f, 3.35908294f, 3.54735184f, 3.7356205f, 3.92388916f, 4.1121583f, 4.30042696f, 4.48869562f, 4.67696428f, 4.86523294f, 5.05350208f, 5.24177074f, 5.43003941f, 5.61830854f, 5.80657721f, 5.99484587f, 6.18311453f, 6.37138319f, 6.55965233f, 6.74792099f, 6.93618965f, 7.12445879f, 7.31272745f, 7.50099611f, 7.68926477f, 7.87753344f, 8.06580162f, 8.25407124f, 8.4423399f, 8.63060856f, 8.81887722f, 9.00714588f, 9.19541454f, 9.3836832f, 9.57195187f, 9.76022053f, 9.94849014f, 10.1367588f, 10.3250275f, 10.5132961f, 10.7015648f, 10.8898335f, 11.0781021f, 11.2663717f, 11.4546404f, 11.642909f, 11.8311777f, 12.0194464f, 12.207715f, 12.3959837f, 12.5842524f, 12.772521f, 12.9607906f, 13.1490593f, 13.337328f, 13.5255966f, 13.7138653f, 13.9021339f, 14.0904026f, 14.2786722f, 14.4669409f, 14.6552095f, 14.8434782f, 15.0317469f, 15.2200155f, 15.4082842f, 15.5965528f, 15.7848215f, 15.9730902f, 16.1613598f, 16.3496284f, 16.537899f, 16.7261677f, 16.9144363f, 17.102705f, 17.2909737f, 17.4792423f, 17.667511f, 17.8557796f, 18.0440483f, 18.232317f, 18.4205856f, 18.6088543f, 3065.92725f, 3066.11548f, 3066.30396f, 3066.49219f, 3066.68042f, 3066.86865f, 3067.05688f, 3067.24512f, 3067.43335f, 3067.62183f, 3067.81006f, 3067.99829f, 3068.18652f, 3068.37476f, 3068.56299f, 3068.75122f, 3068.9397f, 3069.12793f, 3069.31616f, 3069.50439f, 3069.69263f, 3069.88086f, 3070.06934f, 3070.25757f, 3070.4458f, 3070.63403f, 3070.82227f, 3071.0105f, 3071.19873f, 3071.38721f, 3071.57544f, 3071.76367f, 3071.9519f, 3072.14014f, 3072.32837f, 3072.5166f, 3072.70508f, 3072.89331f, 3073.08154f, 3073.26978f, 3073.45801f, 3073.64624f, 3073.83472f, 3074.02295f, 3074.21118f, 3074.39941f, 3074.58765f, 3074.77588f, 3074.96411f, 3075.15259f, 3075.34082f, 3075.52905f, 3075.71729f, 3075.90552f, 3076.09375f, 3076.28198f, 3076.47046f, 3076.65869f, 3076.84692f, 3077.03516f, 3077.22339f, 3077.41162f, 3077.59985f, 3077.78833f, 3077.97656f, 3078.16479f, 3078.35303f, 3078.54126f, 3078.72949f, 3078.91797f, 3079.1062f, 3079.29443f, 3079.48267f, 3079.6709f, 3079.85913f, 3080.04736f, 3080.23584f, 3080.42407f, 3080.6123f, 3080.80054f, 3080.98877f, 3081.177f, 3081.36523f, 3081.55371f, 3081.74194f, 3081.93018f, 3082.11841f, 3082.30664f, 3082.49487f, 3082.68335f, 3082.87158f, 3083.05981f, 3083.24805f, 3083.43628f, 3083.62451f, 3083.81274f, 3084.00122f, 3084.18945f, 3084.37769f};
    std::vector<float> resulting_counts;
    test_rebin_case( original_energies, original_counts, new_energies );
  }
  
  {
    std::vector<float> original_energies{-0.0226090029f, 0.164937198f, 0.352483392f, 0.540029585f, 0.727575779f, 0.915121973f, 1.10266817f, 1.2902143f, 1.47776055f, 1.66530681f, 1.85285294f, 2.04039907f, 2.22794533f, 2.41549158f, 2.6030376f, 2.79058385f, 2.9781301f, 3.16567612f, 3.35322237f, 3.54076838f, 3.72831464f, 3.91586089f, 4.10340691f, 4.29095316f, 4.47849894f, 4.66604519f, 4.85359144f, 5.0411377f, 5.22868347f, 5.41622972f, 5.60377598f, 5.79132223f, 5.97886848f, 6.16641474f, 6.35396099f, 6.54150724f, 6.7290535f, 6.91659927f, 7.10414553f, 7.29169178f, 7.47923803f, 7.66678429f, 7.85433006f, 8.04187679f, 8.22942257f, 8.4169693f, 8.60451508f, 8.79206181f, 8.97960758f, 9.16715336f, 9.35470009f, 9.54224586f, 9.72979259f, 9.91733837f, 10.1048851f, 10.2924309f, 10.4799767f, 10.6675234f, 10.8550692f, 11.0426149f, 11.2301607f, 11.4177074f, 11.6052532f, 11.7927999f, 11.9803457f, 12.1678915f, 12.3554382f, 12.542984f, 12.7305307f, 12.9180765f, 13.1056232f, 13.293169f, 13.4807158f, 13.6682615f, 13.8558073f, 14.043354f, 14.2308989f, 14.4184456f, 14.6059914f, 14.7935381f, 14.9810839f, 15.1686296f, 15.3561764f, 15.5437222f, 15.7312689f, 15.9188147f, 16.1063595f, 16.2939053f, 16.481451f, 16.6689968f, 16.8565445f, 17.0440903f, 17.231636f, 17.4191818f, 17.6067295f, 17.7942753f, 17.9818211f, 18.1693668f, 18.3569126f, 18.5444603f, 3054.05688f, 3054.24438f, 3054.43213f, 3054.61963f, 3054.80713f, 3054.99438f, 3055.18188f, 3055.36963f, 3055.55713f, 3055.74463f, 3055.93213f, 3056.11963f, 3056.30737f, 3056.49487f, 3056.68237f, 3056.86987f, 3057.05737f, 3057.24487f, 3057.43262f, 3057.62012f, 3057.80762f, 3057.99512f, 3058.18262f, 3058.37012f, 3058.55762f, 3058.74512f, 3058.93262f, 3059.12012f, 3059.30786f, 3059.49536f, 3059.68286f, 3059.87036f, 3060.05786f, 3060.24561f, 3060.43311f, 3060.62061f, 3060.80811f, 3060.99561f, 3061.18311f, 3061.37085f, 3061.55835f, 3061.74561f, 3061.93311f, 3062.12061f, 3062.30835f, 3062.49585f, 3062.68335f, 3062.87085f, 3063.05835f, 3063.24609f, 3063.43359f, 3063.62109f, 3063.80859f, 3063.99609f, 3064.18359f, 3064.37134f, 3064.55884f, 3064.74634f, 3064.93384f, 3065.12109f, 3065.30884f, 3065.49634f, 3065.68384f, 3065.87134f, 3066.05884f, 3066.24658f, 3066.43408f, 3066.62158f, 3066.80908f, 3066.99658f, 3067.18433f, 3067.37183f, 3067.55933f, 3067.74683f, 3067.93433f, 3068.12183f, 3068.30957f, 3068.49683f, 3068.68433f, 3068.87183f, 3069.05933f, 3069.24707f, 3069.43457f, 3069.62207f, 3069.80957f, 3069.99707f, 3070.18481f, 3070.37231f, 3070.55981f, 3070.74731f, 3070.93481f, 3071.12231f, 3071.31006f, 3071.49756f, 3071.68506f, 3071.87231f, 3072.05981f, 3072.24756f, 3072.43506f};
    std::vector<float> original_counts{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 3, 14, 53, 119, 229, 358, 375, 396, 360, 401, 410, 420, 458, 438, 437, 417, 403, 414, 416, 404, 386, 423, 405, 369, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0};
    std::vector<float> new_energies{-0.0297551602f, 0.15851362f, 0.346782386f, 0.535051167f, 0.723319948f, 0.911588728f, 1.09985757f, 1.28812635f, 1.47639513f, 1.66466391f, 1.85293269f, 2.04120159f, 2.22947025f, 2.41773891f, 2.60600781f, 2.79427671f, 2.98254538f, 3.17081404f, 3.35908294f, 3.54735184f, 3.7356205f, 3.92388916f, 4.1121583f, 4.30042696f, 4.48869562f, 4.67696428f, 4.86523294f, 5.05350208f, 5.24177074f, 5.43003941f, 5.61830854f, 5.80657721f, 5.99484587f, 6.18311453f, 6.37138319f, 6.55965233f, 6.74792099f, 6.93618965f, 7.12445879f, 7.31272745f, 7.50099611f, 7.68926477f, 7.87753344f, 8.06580162f, 8.25407124f, 8.4423399f, 8.63060856f, 8.81887722f, 9.00714588f, 9.19541454f, 9.3836832f, 9.57195187f, 9.76022053f, 9.94849014f, 10.1367588f, 10.3250275f, 10.5132961f, 10.7015648f, 10.8898335f, 11.0781021f, 11.2663717f, 11.4546404f, 11.642909f, 11.8311777f, 12.0194464f, 12.207715f, 12.3959837f, 12.5842524f, 12.772521f, 12.9607906f, 13.1490593f, 13.337328f, 13.5255966f, 13.7138653f, 13.9021339f, 14.0904026f, 14.2786722f, 14.4669409f, 14.6552095f, 14.8434782f, 15.0317469f, 15.2200155f, 15.4082842f, 15.5965528f, 15.7848215f, 15.9730902f, 16.1613598f, 16.3496284f, 16.537899f, 16.7261677f, 16.9144363f, 17.102705f, 17.2909737f, 17.4792423f, 17.667511f, 17.8557796f, 18.0440483f, 18.232317f, 18.4205856f, 18.6088543f, 3065.92725f, 3066.11548f, 3066.30396f, 3066.49219f, 3066.68042f, 3066.86865f, 3067.05688f, 3067.24512f, 3067.43335f, 3067.62183f, 3067.81006f, 3067.99829f, 3068.18652f, 3068.37476f, 3068.56299f, 3068.75122f, 3068.9397f, 3069.12793f, 3069.31616f, 3069.50439f, 3069.69263f, 3069.88086f, 3070.06934f, 3070.25757f, 3070.4458f, 3070.63403f, 3070.82227f, 3071.0105f, 3071.19873f, 3071.38721f, 3071.57544f, 3071.76367f, 3071.9519f, 3072.14014f, 3072.32837f, 3072.5166f, 3072.70508f, 3072.89331f, 3073.08154f, 3073.26978f, 3073.45801f, 3073.64624f, 3073.83472f, 3074.02295f, 3074.21118f, 3074.39941f, 3074.58765f, 3074.77588f, 3074.96411f, 3075.15259f, 3075.34082f, 3075.52905f, 3075.71729f, 3075.90552f, 3076.09375f, 3076.28198f, 3076.47046f, 3076.65869f, 3076.84692f, 3077.03516f, 3077.22339f, 3077.41162f, 3077.59985f, 3077.78833f, 3077.97656f, 3078.16479f, 3078.35303f, 3078.54126f, 3078.72949f, 3078.91797f, 3079.1062f, 3079.29443f, 3079.48267f, 3079.6709f, 3079.85913f, 3080.04736f, 3080.23584f, 3080.42407f, 3080.6123f, 3080.80054f, 3080.98877f, 3081.177f, 3081.36523f, 3081.55371f, 3081.74194f, 3081.93018f, 3082.11841f, 3082.30664f, 3082.49487f, 3082.68335f, 3082.87158f, 3083.05981f, 3083.24805f, 3083.43628f, 3083.62451f, 3083.81274f, 3084.00122f, 3084.18945f, 3084.37769f};
    std::vector<float> resulting_counts;
    test_rebin_case( original_energies, original_counts, new_energies );
  }
}

//int main( int argc, char **argv )
//{
//  test_rebin();
//  return 0; // ctest will say this test fails if you return a non-zero exit code
//}


